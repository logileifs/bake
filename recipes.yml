---
recipes:
  test: &test
    vars:
      var1: 'harry potter'
      var2: '2'
      build_file: main.go
      from_shell: shell(openssl rand -hex 3)
    steps:
      - echo test step one
      - echo from_shell={{.from_shell}}
      - echo I am watching {{.var1}}
  build: &build
    vars:
      build_var1: 'build_var1'
      build_var2: '2'
      NEW_BUILD_ID: shell(openssl rand -hex 3)
      REPOSITORY: logileifs
      BUILD_ID: ab12c3
    steps:
      - docker build -t {{.REPOSITORY}}/vault-init:{{.BUILD_ID}} .
      - docker push {{.REPOSITORY}}/vault-init:{{.BUILD_ID}}

watch:
  on_save:
    dirs:
      - '.'
    recipes:
      - lint:
          vars: {}
          steps:
            - echo lint step 1
            - echo lint step 2
      - *test
  on_commit:
    dirs:
      - './.git/'
    recipes:
      - *build
      - deploy:
          vars: {}
          steps:
            - echo deploy step 1
            - echo deploy step 2
#watch:
#  dirs:
#    - '.'
#  recipes:
#    - *test
#    - *build
